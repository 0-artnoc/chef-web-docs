<p>To use a template, two things must happen:</p>
<ol>
<li>A template resource must be added to a recipe</li>
<li>An Embedded Ruby (ERB) template must be added to a cookbook</li>
</ol>
<p>For example, the following template file and template resource settings can be used to manage a configuration file named <code>/etc/sudoers</code>. Within a cookbook that uses sudo, the following resource could be added to <code>/recipes/default.rb</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb1-1"><a href="#cb1-1"></a>template <span class="st">&#39;/etc/sudoers&#39;</span> <span class="kw">do</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  source <span class="st">&#39;sudoers.erb&#39;</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>  mode <span class="st">&#39;0440&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  owner <span class="st">&#39;root&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  group <span class="st">&#39;root&#39;</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>  variables(<span class="st">sudoers_groups: </span>node[<span class="st">&#39;authorization&#39;</span>][<span class="st">&#39;sudo&#39;</span>][<span class="st">&#39;groups&#39;</span>],</span>
<span id="cb1-7"><a href="#cb1-7"></a>            <span class="st">sudoers_users: </span>node[<span class="st">&#39;authorization&#39;</span>][<span class="st">&#39;sudo&#39;</span>][<span class="st">&#39;users&#39;</span>])</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="kw">end</span></span></code></pre></div>
<p>And then create a template called <code>sudoers.erb</code> and save it to <code>templates/default/sudoers.erb</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">#</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># /etc/sudoers</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Generated by Chef for &lt;%= node[&#39;fqdn&#39;] %&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#</span></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="dt">Defaults</span>        !lecture,tty_tickets,!fqdn</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co"># User privilege specification</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>root          <span class="dt">ALL</span>=(<span class="dt">ALL</span>) <span class="dt">ALL</span></span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a>&lt;% <span class="ot">@sudoers_users</span>.each <span class="kw">do</span> |user| -<span class="ot">%&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="st">&lt;%= user %</span><span class="ot">&gt;</span>   <span class="dt">ALL</span>=(<span class="dt">ALL</span>) &lt;%= <span class="st">&quot;NOPASSWD:&quot;</span> <span class="kw">if</span> <span class="ot">@passwordless</span> %&gt;<span class="dt">ALL</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>&lt;% <span class="kw">end</span> -<span class="ot">%&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="st"># Members of the sysadmin group may gain root privileges</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="st">%sysadmin     ALL=(ALL) &lt;%= &quot;NOPASSWD:&quot; if @passwordless %</span><span class="ot">&gt;</span><span class="dt">ALL</span></span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a>&lt;% <span class="ot">@sudoers_groups</span>.each <span class="kw">do</span> |group| -<span class="ot">%&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="st"># Members of the group &#39;&lt;%= group %</span><span class="ot">&gt;</span><span class="st">&#39; may gain root privileges</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="st">&lt;%= group %&gt; ALL=(ALL) &lt;%= &quot;NOPASSWD:&quot; if @passwordless %&gt;ALL</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="st">&lt;% end -%&gt;</span></span></code></pre></div>
<p>And then set the default attributes in <code>attributes/default.rb</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1"></a>default[<span class="st">&#39;authorization&#39;</span>][<span class="st">&#39;sudo&#39;</span>][<span class="st">&#39;groups&#39;</span>] =<span class="ot"> %w(</span><span class="st">sysadmin wheel admin</span><span class="ot">)</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>default[<span class="st">&#39;authorization&#39;</span>][<span class="st">&#39;sudo&#39;</span>][<span class="st">&#39;users&#39;</span>] =<span class="ot"> %w(</span><span class="st">jerry greg</span><span class="ot">)</span></span></code></pre></div>
