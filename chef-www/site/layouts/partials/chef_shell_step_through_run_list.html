<p>To explore how using the <strong>breakpoint</strong> to manually step through a Chef Infra Client run, create a simple recipe in chef-shell:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a>$ <span class="ex">chef</span> <span class="op">&gt;</span> recipe_mode</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> echo off</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> file <span class="st">&quot;/tmp/before-breakpoint&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> breakpoint <span class="st">&quot;foo&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> file <span class="st">&quot;/tmp/after-breakpoint&quot;</span></span></code></pre></div>
<p>and then run Chef Infra Client:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a>$ <span class="ex">chef</span>:recipe <span class="op">&gt;</span> run_chef</span>
<span id="cb2-2"><a href="#cb2-2"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:17:49 -0800] DEBUG: Processing file[/tmp/before-breakpoint]</span>
<span id="cb2-3"><a href="#cb2-3"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:17:49 -0800] DEBUG: file[/tmp/before-breakpoint] using Chef::Provider::File</span>
<span id="cb2-4"><a href="#cb2-4"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:17:49 -0800] INFO: Creating file[/tmp/before-breakpoint] at /tmp/before-breakpoint</span>
<span id="cb2-5"><a href="#cb2-5"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:17:49 -0800] DEBUG: Processing [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="st">&#39;new&#39;</span>]</span>
<span id="cb2-6"><a href="#cb2-6"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:17:49 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="st">&#39;new&#39;</span>] using Chef::Provider::Breakpoint</span></code></pre></div>
<p>Chef Infra Client ran the first resource before the breakpoint (<code>file[/tmp/before-breakpoint]</code>), but then stopped after execution. Chef Infra Client attempted to name the breakpoint after its position in the source file, but Chef Infra Client was confused because the resource was entered interactively. From here, chef-shell can resume the interrupted Chef Infra Client run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a>$ <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.resume</span>
<span id="cb3-2"><a href="#cb3-2"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:27:08 -0800] INFO: Creating file[/tmp/after-breakpoint] at /tmp/after-breakpoint</span></code></pre></div>
<p>A quick view of the <code>/tmp</code> directory shows that the following files were created:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="ex">after-breakpoint</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="ex">before-breakpoint</span></span></code></pre></div>
<p>You can rewind and step through a Chef Infra Client run:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a>$ <span class="ex">chef</span>:recipe <span class="op">&gt;</span> Chef::Log.level = :debug <span class="co"># debug logging won&#39;t turn on automatically in this case</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    =<span class="op">&gt;</span> :<span class="ex">debug</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.rewind</span>
<span id="cb5-4"><a href="#cb5-4"></a>    =<span class="op">&gt;</span> <span class="ex">0</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.step</span>
<span id="cb5-6"><a href="#cb5-6"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:40:52 -0800] DEBUG: Processing file[/tmp/before-breakpoint]</span>
<span id="cb5-7"><a href="#cb5-7"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:40:52 -0800] DEBUG: file[/tmp/before-breakpoint] using Chef::Provider::File</span>
<span id="cb5-8"><a href="#cb5-8"></a>    =<span class="op">&gt;</span> <span class="ex">1</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.step</span>
<span id="cb5-10"><a href="#cb5-10"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:40:54 -0800] DEBUG: Processing [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="st">&#39;new&#39;</span>]</span>
<span id="cb5-11"><a href="#cb5-11"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:40:54 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="st">&#39;new&#39;</span>] using Chef::Provider::Breakpoint</span>
<span id="cb5-12"><a href="#cb5-12"></a>    =<span class="op">&gt;</span> <span class="ex">2</span></span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.step</span>
<span id="cb5-14"><a href="#cb5-14"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:40:56 -0800] DEBUG: Processing file[/tmp/after-breakpoint]</span>
<span id="cb5-15"><a href="#cb5-15"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:40:56 -0800] DEBUG: file[/tmp/after-breakpoint] using Chef::Provider::File</span>
<span id="cb5-16"><a href="#cb5-16"></a>    =<span class="op">&gt;</span> <span class="ex">3</span></span></code></pre></div>
<p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, Chef Infra Client will skip creating them. If the files are deleted, then:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a>$ <span class="ex">chef</span>:recipe <span class="op">&gt;</span> ls(<span class="st">&quot;/tmp&quot;</span>)<span class="ex">.grep</span>(/breakpoint/)<span class="ex">.each</span> {<span class="kw">|</span><span class="ex">f</span><span class="kw">|</span> <span class="fu">rm</span> <span class="st">&quot;/tmp/#{f}&quot;</span> }</span>
<span id="cb6-2"><a href="#cb6-2"></a>    =<span class="op">&gt;</span> [<span class="st">&quot;after-breakpoint&quot;</span>, <span class="st">&quot;before-breakpoint&quot;</span>]</span></code></pre></div>
<p>Rewind, and then resume your Chef Infra Client run to get the expected results:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a>$ <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.rewind</span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.resume</span>
<span id="cb7-3"><a href="#cb7-3"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:48:56 -0800] DEBUG: Processing file[/tmp/before-breakpoint]</span>
<span id="cb7-4"><a href="#cb7-4"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:48:56 -0800] DEBUG: file[/tmp/before-breakpoint] using Chef::Provider::File</span>
<span id="cb7-5"><a href="#cb7-5"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:48:56 -0800] INFO: Creating file[/tmp/before-breakpoint] at /tmp/before-breakpoint</span>
<span id="cb7-6"><a href="#cb7-6"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:48:56 -0800] DEBUG: Processing [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="st">&#39;new&#39;</span>]</span>
<span id="cb7-7"><a href="#cb7-7"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:48:56 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="st">&#39;new&#39;</span>] using Chef::Provider::Breakpoint</span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="ex">chef</span>:recipe <span class="op">&gt;</span> chef_run.resume</span>
<span id="cb7-9"><a href="#cb7-9"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:49:20 -0800] DEBUG: Processing file[/tmp/after-breakpoint]</span>
<span id="cb7-10"><a href="#cb7-10"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:49:20 -0800] DEBUG: file[/tmp/after-breakpoint] using Chef::Provider::File</span>
<span id="cb7-11"><a href="#cb7-11"></a>  [<span class="ex">Fri</span>, 15 Jan 2010 14:49:20 -0800] INFO: Creating file[/tmp/after-breakpoint] at /tmp/after-breakpoint</span></code></pre></div>
