<p>In some cases, the value for a property cannot be known until the execution phase of a Chef Infra Client run. In this situation, using lazy evaluation of property values can be helpful. Instead of a property being assigned a value, it may instead be assigned a code block. The syntax for using lazy evaluation is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb1-1"><a href="#cb1-1"></a>attribute_name lazy { code_block }</span></code></pre></div>
<p>where <code>lazy</code> is used to tell Chef Infra Client to evaluate the contents of the code block later on in the resource evaluation process (instead of immediately) and <code>{ code_block }</code> is arbitrary Ruby code that provides the value.</p>
<p>For example, a resource that is <strong>not</strong> doing lazy evaluation:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb2-1"><a href="#cb2-1"></a>template <span class="st">&#39;template_name&#39;</span> <span class="kw">do</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="co"># some attributes</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  path <span class="st">&#39;/foo/bar&#39;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">end</span></span></code></pre></div>
<p>and a resource block that is doing lazy evaluation:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb3-1"><a href="#cb3-1"></a>template <span class="st">&#39;template_name&#39;</span> <span class="kw">do</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="co"># some attributes</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  path lazy { <span class="st">&#39; some Ruby code &#39;</span> }</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">end</span></span></code></pre></div>
<p>In the previous examples, the first resource uses the value <code>/foo/bar</code> and the second resource uses the value provided by the code block, as long as the contents of that code block are a valid resource property.</p>
<p>The following example shows how to use lazy evaluation with template variables:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb4-1"><a href="#cb4-1"></a>template <span class="st">&#39;/tmp/canvey_island.txt&#39;</span> <span class="kw">do</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  source <span class="st">&#39;canvey_island.txt.erb&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  variables(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    lazy {</span>
<span id="cb4-5"><a href="#cb4-5"></a>      { <span class="st">canvey_island: </span>node.run_state[<span class="st">&#39;sea_power&#39;</span>] }</span>
<span id="cb4-6"><a href="#cb4-6"></a>    }</span>
<span id="cb4-7"><a href="#cb4-7"></a>  )</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">end</span></span></code></pre></div>
